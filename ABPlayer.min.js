function isMobile(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a}function CommentLoader(a,b,c){null==c&&(c=function(){});var d=null;d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d.open("GET",a,!0),d.send();var e=b;d.onreadystatechange=function(){if(4==d.readyState&&200==d.status)if("Microsoft Internet Explorer"==navigator.appName){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1,a.loadXML(d.responseText),e.load(BilibiliParser(a)),c()}else e.load(BilibiliParser(d.responseXML)),c()}}function createCORSRequest(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c}var ABP={version:"0.8.0"};!function(){"use strict";if(ABP){var a=function(a){return document.getElementById(a)},b=function(a,b,c,d){var e=null;if("text"===a)return document.createTextNode(b);e=document.createElement(a);for(var f in b)if("style"!==f&&"className"!==f)e.setAttribute(f,b[f]);else if("className"===f)e.className=b[f];else for(var g in b.style)e.style[g]=b.style[g];if(c)for(var h=0;h<c.length;h++)null!=c[h]&&e.appendChild(c[h]);return d&&"function"==typeof d&&d(e),e},c=function(a,b){for(;a;a=a.parentNode)if(k(a.parentNode,b))return a};HTMLElement.prototype.tooltip=function(a){this.tooltipData=a,this.dispatchEvent(new Event("updatetooltip"))},"undefined"==typeof HTMLElement.prototype.requestFullScreen&&(HTMLElement.prototype.requestFullScreen=function(){this.webkitRequestFullscreen?this.webkitRequestFullscreen():this.mozRequestFullScreen?this.mozRequestFullScreen():this.msRequestFullscreen&&this.msRequestFullscreen()}),"undefined"==typeof document.isFullScreen&&(document.isFullScreen=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenEnabled}),"undefined"==typeof document.exitFullscreen&&(document.exitFullscreen=function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():msExitFullscreen&&msExitFullscreen()});var d=function(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},e=function(a,b){for(var c="",d=1;d<=b-(a+"").length;d++)c+="0";return c+a},f=function(a,b){for(var c="",d=1;d<=b-(a+"").length;d++)c+="0";return c+a},g=function(a,b){if(0==a)return lang.oneDay;var c,d,e,f,g,h,i=new Date(1e3*parseInt(a));return c=String(i.getFullYear()),d=String(i.getMonth()+1),1==d.length&&(d="0"+d),e=String(i.getDate()),1==e.length&&(e="0"+e),f=String(i.getHours()),1==f.length&&(f="0"+f),g=String(i.getMinutes()),1==g.length&&(g="0"+g),h=String(i.getSeconds()),1==h.length&&(h="0"+h),String(b?d+"-"+e+" "+f+":"+g:c+"-"+d+"-"+e+" "+f+":"+g+":"+h)},f=function(a){return e(parseInt(a/60),2)+":"+e(parseInt(a%60),2)},h=function(a){for(var b=a.split(":"),c=0,d=0;d<b.length;d++){c*=60;var e=parseInt(b[d]);if(isNaN(e)||0>e)return!1;c+=e}return c},i=function(e,f,g){e&&(e.addEventListener("mousemove",function(d){var h=a("ABP-Tooltip"),i=e.clientWidth,j=e.clientHeight,k=e.getBoundingClientRect(),l=c(e,"ABP-Unit").getBoundingClientRect(),m=k.top-l.top,n=f?d.clientX-l.left:k.left-l.left;null==h&&(h=b("div",{id:"ABP-Tooltip"},[b("text",e.tooltipData)]),h.by=e,c(e,"ABP-Unit").appendChild(h),h.style.top=m+j+2+"px",h.style.left=n+i/2-h.clientWidth/2+"px"),f&&(h.style.left=n-h.clientWidth/2+"px"),g&&(h.style.top=m-h.clientHeight+2+g+"px")}),e.addEventListener("mouseout",function(){var b=a("ABP-Tooltip");b&&b.parentNode&&b.parentNode.removeChild(b)}),e.addEventListener("updatetooltip",function(b){var c=a("ABP-Tooltip");c&&c.by==b.target&&(c.innerHTML=d(e.tooltipData))}))},j=function(a,b){if(null!=a){var c=a.className.split(" ");""==c[0]&&(c=[]),c.indexOf(b)<0&&c.push(b),a.className=c.join(" ")}},k=function(a,b){if(null==a)return!1;var c=a.className.split(" ");return""==c[0]&&(c=[]),c.indexOf(b)>=0},l=function(a,b){if(null!=a){var c=a.className.split(" ");""==c[0]&&(c=[]),c.indexOf(b)>=0&&c.splice(c.indexOf(b),1),a.className=c.join(" ")}},m=function(a,b){var c={};for(var d in b)c[d]=a&&"undefined"!=typeof a[d]?a[d]:b[d];return c};ABP.create=function(c,d){var e=c;if(d||(d={}),d=m(d,{replaceMode:!0,width:512,height:384,src:"",mobile:!1}),"string"==typeof c&&(e=a(c)),k(e,"ABP-Unit"))f=e;else{var f=b("div",{className:"ABP-Unit",style:{width:d.width.toString().indexOf("%")>=0?d.width:d.width+"px",height:d.height.toString().indexOf("%")>=0?d.height:d.height+"px"}});e.appendChild(f)}f.children.length>0&&d.replaceMode&&(f.innerHTML="");var g=[],h=[];if("string"==typeof d.src)d.src=b("video",{autobuffer:"true",dataSetup:"{}"},[b("source",{src:d.src})]),g.push(d.src);else if(d.src.hasOwnProperty("playlist"))for(var i=d.src,j=i.playlist,l=0;l<j.length;l++){if(j[l].hasOwnProperty("sources")){var n=[];for(var o in j[l].sources)n.push(b("source",{src:j[l][o],type:o}));g.push(b("video",{autobuffer:"true",dataSetup:"{}"},n))}else j[l].hasOwnProperty("video")?g.push(j[l].video):console.log("No recognized format");h.push(j[l].comments)}else g.push(d.src);f.appendChild(b("div",{className:"ABP-Player"},[b("div",{className:"ABP-Video",tabindex:"10"},[b("div",{className:"ABP-Container"}),g[0]]),b("div",{className:"ABP-Text"},[b("div",{className:"ABP-CommentStyle"},[b("div",{className:"button ABP-Comment-Font icon-font-style"}),b("div",{className:"button ABP-Comment-Color icon-color-mode"})]),b("input",{value:"哔哩哔哩助手 HTML5 播放器即将支持弹幕发送功能，敬请期待",disabled:"disabled"}),b("div",{className:"ABP-Comment-Send"},[b("text","发送")])]),b("div",{className:"ABP-Control"},[b("div",{className:"button ABP-Play icon-play"}),b("div",{className:"progress-bar"},[b("div",{className:"bar"},[b("div",{className:"load"}),b("div",{className:"dark"})])]),b("div",{className:"time-label"},[b("text","00:00 / 00:00")]),b("div",{className:"button ABP-Volume icon-volume-high"}),b("div",{className:"volume-bar"},[b("div",{className:"bar"},[b("div",{className:"load"})])]),b("div",{className:"button-group ABP-CommentGroup"},[b("div",{className:"button ABP-CommentShow icon-comment on"}),b("div",{className:"ABP-CommentOption"},[b("p",{className:"label"},[b("text","弹幕不透明度")]),b("div",{className:"opacity-bar"},[b("div",{className:"bar"},[b("div",{className:"load"})])])])]),b("div",{className:"button ABP-Loop icon-loop"}),b("div",{className:"button ABP-WideScreen icon-tv"}),b("div",{className:"button-group ABP-FullScreenGroup"},[b("div",{className:"button ABP-FullScreen icon-screen-full"}),b("div",{className:"button ABP-Web-FullScreen icon-screen"})])])])),f.appendChild(b("div",{className:"ABP-Comment-List"},[b("div",{className:"ABP-Comment-List-Title"},[b("div",{className:"time"},[b("text","时间")]),b("div",{className:"content"},[b("text","评论")]),b("div",{className:"date"},[b("text"," 发送日期")])]),b("div",{className:"ABP-Comment-List-Container"},[b("ul",{className:"ABP-Comment-List-Container-Inner"})])]));var p=ABP.bind(f,d.mobile);if(g.length>0){var q=g[0];p.gotoNext=function(){var a=g.indexOf(q)+1;if(a<g.length){q=g[a],q.style.display="";var b=p.video.parentNode;b.removeChild(p.video),b.appendChild(q),p.video.style.display="none",p.video=q,p.swapVideo(q),q.addEventListener("ended",function(){p.gotoNext()})}a<h.length&&null!==h[a]&&CommentLoader(h[a],p.cmManager)},q.addEventListener("ended",function(){p.gotoNext()}),CommentLoader(h[0],p.cmManager)}return p},ABP.load=function(){},ABP.bind=function(a,c,d){var e={playerUnit:a,btnPlay:null,barTime:null,barLoad:null,barTimeHitArea:null,barVolume:null,barVolumeHitArea:null,barOpacity:null,barOpacityHitArea:null,btnFont:null,btnColor:null,btnSend:null,controlBar:null,timeLabel:null,timeJump:null,divComment:null,btnWide:null,btnFull:null,btnWebFull:null,btnDm:null,btnLoop:null,videoDiv:null,btnVolume:null,video:null,divTextField:null,txtText:null,cmManager:null,commentList:null,commentListContainer:null,lastSelectedComment:null,commentScale:.9,defaults:{w:0,h:0},state:m(d,{fullscreen:!1,commentVisible:!0,allowRescale:!1,autosize:!1}),createPopup:function(c,d){if(a.hasPopup===!0)return!1;var e=b("div",{className:"ABP-Popup"},[b("text",c)]);return e.remove=function(){e.isRemoved||(e.isRemoved=!0,a.removeChild(e),a.hasPopup=!1)},a.appendChild(e),a.hasPopup=!0,"number"==typeof d&&setTimeout(function(){e.remove()},d),e},removePopup:function(){for(var b=a.getElementsByClassName("ABP-Popup"),c=0;c<b.length;c++)null!=b[c].remove?b[c].remove():b[c].parentNode.removeChild(b[c]);a.hasPopup=!1},loadCommentList:function(a,c){c="asc"==c?-1:1;var d=Object.keys(e.commentList).sort(function(b,d){return e.commentList[b][a]<e.commentList[d][a]?c:e.commentList[b][a]>e.commentList[d][a]?-c:0});e.commentObjArray=[];for(p in d){var h=d[p],j=e.commentList[h];if(j&&j.time){var k=b("li",{}),l=b("span",{className:"time"},[b("text",f(j.time/1e3))]),m=b("span",{className:"content"},[b("text",j.content)]),n=b("span",{className:"date"},[b("text",g(j.date,!0))]);i(m,!1,36),i(n,!1,18),m.tooltip(j.content),n.tooltip(g(j.date)),k.appendChild(l),k.appendChild(m),k.appendChild(n),k.data=j,k.addEventListener("dblclick",function(){e.video.currentTime=this.data.time/1e3,Q(o.currentTime)}),e.commentObjArray.push(k)}}e.commentListContainer.style.height=24*e.commentObjArray.length+"px",e.renderCommentList()},renderCommentList:function(){var a=e.commentListContainer.parentElement.scrollTop,b=parseInt(a/24);e.commentListContainer.innerHTML="";for(var c=b;b+40>=c&&"undefined"!=typeof e.commentObjArray[c];c++){if(c==b&&c>0){var d=e.commentObjArray[c].cloneNode(!0),f=d.getElementsByClassName("content")[0],h=d.getElementsByClassName("date")[0];d.addEventListener("dblclick",function(){e.video.currentTime=e.commentObjArray[c].data.time/1e3,Q(o.currentTime)}),i(f,!1,36),i(h,!1,18),f.tooltip(e.commentObjArray[c].data.content),h.tooltip(g(e.commentObjArray[c].data.date)),d.style.paddingTop=24*b+"px"}else var d=e.commentObjArray[c];e.commentListContainer.appendChild(d)}e.commentListContainer.parentElement.scrollTop=a},swapVideo:null};if(e.swapVideo=function(b){b.addEventListener("timeupdate",function(){P||Q(b.currentTime)}),b.addEventListener("ended",function(){e.btnPlay.className="button ABP-Play icon-play",e.barTime.style.width="0%"}),b.addEventListener("progress",function(){if(null!=this.buffered){try{var a=(this.buffered.start(0),this.buffered.end(0))}catch(b){return}var c=this.duration,d=a/c*100;e.barLoad.style.width=d+"%"}}),b.addEventListener("loadedmetadata",function(){if(null!=this.buffered){try{var a=(this.buffered.start(0),this.buffered.end(0))}catch(b){return}var c=this.duration,d=a/c*100;e.barLoad.style.width=d+"%"}}),b.isBound=!0;var c=0;e.cmManager&&(e.cmManager.options.scrollScale=1.3,e.cmManager.options.opacity=.8,e.cmManager.addEventListener("load",function(){e.commentList={};for(p in e.cmManager.timeline){var a=e.cmManager.timeline[p];e.commentList[a.dbid]={date:a.date,time:a.stime,mode:a.mode,user:a.hash,pool:a.pool,content:a.text}}e.loadCommentList("date","asc"),e.commentListContainer.parentElement.addEventListener("scroll",e.renderCommentList)}),e.cmManager.setBounds=function(){a.offsetHeight<=300||a.offsetWidth<=700?j(a,"ABP-Mini"):l(a,"ABP-Mini");var b=e.videoDiv.offsetWidth,c=e.videoDiv.offsetHeight,d=c/438*e.commentScale;this.width=b/d,this.height=438/e.commentScale,this.dispatchEvent("resize");for(var f in this.csa)this.csa[f].setBounds(this.width,this.height);this.stage.style.width=b/d+"px",this.stage.style.height=438/e.commentScale+"px",this.stage.style.perspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.transform="scale("+d+")",this.stage.style.webkitTransform="scale("+d+")"},e.cmManager.setBounds(),e.cmManager.clear(),b.addEventListener("progress",function(){c==b.currentTime?(b.hasStalled=!0,e.cmManager.stopTimer()):c=b.currentTime}),window&&window.addEventListener("resize",function(){e.cmManager.setBounds()}),b.addEventListener("timeupdate",function(){e.cmManager.display!==!1&&(b.hasStalled&&(e.cmManager.startTimer(),b.hasStalled=!1),e.cmManager.time(Math.floor(1e3*b.currentTime)))}),b.addEventListener("play",function(){e.cmManager.setBounds(),e.cmManager.startTimer();try{var a=this.buffered.end(0),b=this.duration,c=a/b*100;e.barLoad.style.width=c+"%"}catch(d){}}),b.addEventListener("ratechange",function(){null!=e.cmManager.options.globalScale&&0!==b.playbackRate&&(e.cmManager.options.globalScale=1/b.playbackRate,e.cmManager.rescale())}),b.addEventListener("pause",function(){e.cmManager.stopTimer()}),b.addEventListener("waiting",function(){e.cmManager.stopTimer()}),b.addEventListener("playing",function(){e.cmManager.startTimer()}))},null!==a&&null!==a.getElementsByClassName){e.defaults.w=a.offsetWidth,e.defaults.h=a.offsetHeight;var n=a.getElementsByClassName("ABP-Video");if(!(n.length<=0)){var o=null;e.videoDiv=n[0];for(var p in n[0].children)if(null!=n[0].children[p].tagName&&"VIDEO"===n[0].children[p].tagName.toUpperCase()){o=n[0].children[p];break}n[0]&&c&&(n[0].style.bottom="0px");var q=n[0].getElementsByClassName("ABP-Container");if(q.length>0&&(e.divComment=q[0]),null!==o){e.video=o;var r=a.getElementsByClassName("ABP-Play");if(!(r.length<=0)){e.btnPlay=r[0],e.btnPlay.tooltip("播放"),i(e.btnPlay);var s=a.getElementsByClassName("progress-bar");if(!(s.length<=0)){var t=s[0].getElementsByClassName("bar");e.barTimeHitArea=t[0],e.barLoad=t[0].getElementsByClassName("load")[0],e.barTime=t[0].getElementsByClassName("dark")[0];var u=a.getElementsByClassName("time-label");if(!(u.length<=0)){e.timeLabel=u[0];var v=a.getElementsByClassName("ABP-Volume");if(!(v.length<=0)){e.btnVolume=v[0],e.btnVolume.tooltip("静音"),i(e.btnVolume);var w=a.getElementsByClassName("volume-bar");if(!(w.length<=0)){var x=w[0].getElementsByClassName("bar");e.barVolumeHitArea=x[0],e.barVolume=x[0].getElementsByClassName("load")[0];var y=a.getElementsByClassName("opacity-bar");if(!(y.length<=0)){var y=y[0].getElementsByClassName("bar");e.barOpacityHitArea=y[0],e.barOpacity=y[0].getElementsByClassName("load")[0];var z=a.getElementsByClassName("ABP-FullScreen");if(!(z.length<=0)){e.btnFull=z[0],e.btnFull.tooltip("浏览器全屏"),i(e.btnFull);var A=a.getElementsByClassName("ABP-Web-FullScreen");if(!(A.length<=0)){e.btnWebFull=A[0],e.btnWebFull.tooltip("网页全屏"),i(e.btnWebFull);var B=a.getElementsByClassName("ABP-WideScreen");if(!(B.length<=0)){e.btnWide=B[0],e.btnWide.tooltip("宽屏模式"),i(e.btnWide);var C=a.getElementsByClassName("ABP-Comment-Font");if(!(C.length<=0)){e.btnFont=C[0],e.btnFont.tooltip("弹幕样式"),i(e.btnFont);var D=a.getElementsByClassName("ABP-Comment-Color");if(!(D.length<=0)){e.btnColor=D[0],e.btnColor.tooltip("弹幕颜色"),i(e.btnColor);var E=a.getElementsByClassName("ABP-Text");if(E.length>0){e.divTextField=E[0];var F=E[0].getElementsByTagName("input");F.length>0&&(e.txtText=F[0])}var G=a.getElementsByClassName("ABP-Comment-List-Container-Inner");if(!(G.length<=0)){e.commentListContainer=G[0];var H=a.getElementsByClassName("ABP-Comment-Send");if(!(H.length<=0)){e.btnSend=H[0],e.btnSend.tooltip("毁灭地喷射白光!da!"),i(e.btnSend);var I=a.getElementsByClassName("ABP-Control");I.length>0&&(e.controlBar=I[0]);var J=a.getElementsByClassName("ABP-CommentShow");if(!(J.length<=0)){e.btnDm=J[0],e.btnDm.tooltip("隐藏弹幕"),i(e.btnDm);var K=a.getElementsByClassName("ABP-Loop");if(!(K.length<=0)){if(e.btnLoop=K[0],e.btnLoop.tooltip("洗脑循环 off"),i(e.btnLoop),"undefined"!=typeof CommentManager&&(e.cmManager=new CommentManager(e.divComment),e.cmManager.display=!0,e.cmManager.init(),e.cmManager.clear(),window&&window.addEventListener("resize",function(){e.cmManager.setBounds()})),c){var L=-1,M=function(){e.controlBar.style.display="none",e.divTextField.style.display="none",e.divComment.style.bottom="0px",e.cmManager.setBounds()};e.divComment.style.bottom=e.controlBar.offsetHeight+e.divTextField.offsetHeight+"px";var N=function(){e.controlBar.style.display="",e.divTextField.style.display="",e.divComment.style.bottom=e.controlBar.offsetHeight+e.divTextField.offsetHeight+"px";try{-1!=L&&(clearInterval(L),L=-1),L=setInterval(function(){document.activeElement!==e.txtText&&(M(),clearInterval(L),L=-1)},2500)}catch(a){console.log(a)}};a.addEventListener("touchmove",N),a.addEventListener("mousemove",N),L=setTimeout(function(){M()},4e3)}if(o.isBound!==!0){e.swapVideo(o),e.videoDiv.addEventListener("click",function(a){e.btnPlay.click(),a.preventDefault()}),e.btnVolume.addEventListener("click",function(){0==e.video.muted?(e.video.muted=!0,this.className="button ABP-Volume icon-volume-mute2",this.tooltip("取消静音"),e.barVolume.style.width="0%"):(e.video.muted=!1,this.className="button ABP-Volume icon-volume-",this.className+=e.video.volume<.1?"mute":e.video.volume<.33?"low":e.video.volume<.67?"medium":"high",this.tooltip("静音"),e.barVolume.style.width=100*e.video.volume+"%")}),e.btnWebFull.addEventListener("click",function(){e.state.fullscreen=k(a,"ABP-FullScreen"),j(a,"ABP-FullScreen"),e.btnFull.className="button ABP-FullScreen icon-screen-normal",e.btnFull.tooltip("退出网页全屏"),e.state.fullscreen=!0,e.cmManager&&e.cmManager.setBounds(),e.state.allowRescale&&(e.state.fullscreen?e.defaults.w>0&&(e.cmManager.options.scrollScale=a.offsetWidth/e.defaults.w):e.cmManager.options.scrollScale=1)});var O=function(){!document.isFullScreen()&&k(a,"ABP-FullScreen")&&(l(a,"ABP-FullScreen"),e.btnFull.className="button ABP-FullScreen icon-screen-full",e.btnFull.tooltip("浏览器全屏"))};document.addEventListener("fullscreenchange",O,!1),document.addEventListener("webkitfullscreenchange",O,!1),document.addEventListener("mozfullscreenchange",O,!1),document.addEventListener("MSFullscreenChange",O,!1),e.btnFull.addEventListener("click",function(){e.state.fullscreen=k(a,"ABP-FullScreen"),e.state.fullscreen?(l(a,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-full",this.tooltip("浏览器全屏"),document.exitFullscreen()):(j(a,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-normal",this.tooltip("退出全屏"),a.requestFullScreen()),e.state.fullscreen=!e.state.fullscreen,e.cmManager&&e.cmManager.setBounds(),e.state.allowRescale&&(e.state.fullscreen?e.defaults.w>0&&(e.cmManager.options.scrollScale=a.offsetWidth/e.defaults.w):e.cmManager.options.scrollScale=1)}),e.btnWide.addEventListener("click",function(){e.state.widescreen=k(a,"ABP-WideScreen"),e.state.widescreen?(l(a,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv",a.dispatchEvent(new Event("normal")),this.tooltip("宽屏模式")):(j(a,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv on",a.dispatchEvent(new Event("wide")),this.tooltip("退出宽屏")),e.state.widescreen=!e.state.widescreen,e.cmManager&&e.cmManager.setBounds(),e.state.allowRescale&&(e.state.fullscreen?e.defaults.w>0&&(e.cmManager.options.scrollScale=a.offsetWidth/e.defaults.w):e.cmManager.options.scrollScale=1)}),e.btnDm.addEventListener("click",function(){0==e.cmManager.display?(e.cmManager.display=!0,e.cmManager.startTimer(),this.className="button ABP-CommentShow icon-comment on",this.tooltip("隐藏弹幕")):(e.cmManager.display=!1,e.cmManager.clear(),e.cmManager.stopTimer(),this.className="button ABP-CommentShow icon-comment",this.tooltip("显示弹幕"))}),e.btnLoop.addEventListener("click",function(){0==e.video.loop?(e.video.loop=!0,this.className="button ABP-Loop icon-loop on",this.tooltip("洗脑循环 on")):(e.video.loop=!1,this.className="button ABP-Loop icon-loop",this.tooltip("洗脑循环 off"))}),e.timeLabel.addEventListener("click",function(){e.timeJump=b("input",{className:"time-jump"}),e.timeJump.value=f(e.video.currentTime),e.controlBar.appendChild(e.timeJump),e.timeJump.addEventListener("blur",function(){e.timeJump&&e.timeJump.parentNode.removeChild(e.timeJump),e.timeJump=null}),e.timeJump.addEventListener("keydown",function(a){if(13==a.keyCode){var b=h(e.timeJump.value);b&&b<=e.video.duration&&(e.video.currentTime=b,e.video.paused&&e.btnPlay.click()),e.timeJump.parentNode.removeChild(e.timeJump)}else(a.keyCode<48||a.keyCode>58)&&8!=a.keyCode&&37!=a.keyCode&&39!=a.keyCode&&46!=a.keyCode&&a.preventDefault()}),e.timeJump.focus(),e.timeJump.select()}),e.barTime.style.width="0%";var P=!1;e.barTimeHitArea.addEventListener("mousedown",function(){P=!0}),document.addEventListener("mouseup",function(a){if(P){var b=(a.clientX-e.barTimeHitArea.getBoundingClientRect().left)/e.barTimeHitArea.offsetWidth*e.video.duration;0>b&&(b=0),Math.abs(b-e.video.currentTime)>4&&e.cmManager&&e.cmManager.clear(),e.video.currentTime=b}P=!1});var Q=function(a){e.barTime.style.width=a/o.duration*100+"%",e.timeLabel.innerHTML=f(a)+" / "+f(o.duration)};document.addEventListener("mousemove",function(a){var b=(a.clientX-e.barTimeHitArea.getBoundingClientRect().left)/e.barTimeHitArea.offsetWidth*e.video.duration;0>b&&(b=0),b>e.video.duration&&(b=e.video.duration),e.barTimeHitArea.tooltip(f(b)),P&&Q(b)}),i(e.barTimeHitArea,!0,-12);var R=!1;e.barVolumeHitArea.addEventListener("mousedown",function(){R=!0}),e.barVolume.style.width=100*e.video.volume+"%";var S=function(a){e.barVolume.style.width=100*a+"%",e.video.muted=!1,e.btnVolume.className="button ABP-Volume icon-volume-",e.btnVolume.className+=.1>a?"mute":.33>a?"low":.67>a?"medium":"high",e.btnVolume.tooltip("静音"),e.barVolumeHitArea.tooltip(parseInt(100*a)+"%")};document.addEventListener("mouseup",function(a){if(R){var b=(a.clientX-e.barVolumeHitArea.getBoundingClientRect().left)/e.barVolumeHitArea.offsetWidth;0>b&&(b=0),b>1&&(b=1),e.video.volume=b,S(e.video.volume)}R=!1}),document.addEventListener("mousemove",function(a){var b=(a.clientX-e.barVolumeHitArea.getBoundingClientRect().left)/e.barVolumeHitArea.offsetWidth;0>b&&(b=0),b>1&&(b=1),R?(e.video.volume=b,S(e.video.volume)):e.barVolumeHitArea.tooltip(parseInt(100*b)+"%")}),i(e.barVolumeHitArea,!0,-12);var T=!1;e.barOpacityHitArea.addEventListener("mousedown",function(){T=!0}),e.barOpacity.style.width=100*e.cmManager.options.opacity+"%";var U=function(a){e.barOpacity.style.width=100*a+"%",e.barOpacityHitArea.tooltip(parseInt(100*a)+"%")};document.addEventListener("mouseup",function(a){if(T){var b=(a.clientX-e.barOpacityHitArea.getBoundingClientRect().left)/e.barOpacityHitArea.offsetWidth;0>b&&(b=0),b>1&&(b=1),e.cmManager.options.opacity=b,U(e.cmManager.options.opacity)}T=!1}),document.addEventListener("mousemove",function(a){var b=(a.clientX-e.barOpacityHitArea.getBoundingClientRect().left)/e.barOpacityHitArea.offsetWidth;0>b&&(b=0),b>1&&(b=1),T?(e.cmManager.options.opacity=b,U(e.cmManager.options.opacity)):e.barOpacityHitArea.tooltip(parseInt(100*b)+"%")}),i(e.barOpacityHitArea,!0,-6),e.btnPlay.addEventListener("click",function(){e.video.paused?(e.video.play(),this.className="button ABP-Play ABP-Pause icon-pause",this.tooltip("暂停")):(e.video.pause(),this.className="button ABP-Play icon-play",this.tooltip("播放"))}),a.addEventListener("keydown",function(a){if(a&&document.activeElement!==e.txtText&&document.activeElement!==e.timeJump)switch(a.preventDefault(),a.keyCode){case 32:e.btnPlay.click();break;case 37:var b=e.video.currentTime-=5;e.cmManager.clear(),0>b&&(b=0),e.video.currentTime=b.toFixed(3),e.video.paused&&e.btnPlay.click(),Q(o.currentTime),e.barTimeHitArea.tooltip(f(o.currentTime));break;case 39:var b=e.video.currentTime+=5;e.cmManager.clear(),b>e.video.duration&&(b=e.video.duration),e.video.currentTime=b.toFixed(3),e.video.paused&&e.btnPlay.click(),Q(o.currentTime),e.barTimeHitArea.tooltip(f(o.currentTime));break;case 38:var c=e.video.volume+.1;c>1&&(c=1),e.video.volume=c.toFixed(3),S(e.video.volume);break;case 40:var c=e.video.volume-.1;0>c&&(c=0),e.video.volume=c.toFixed(3),S(e.video.volume)}}),a.addEventListener("touchmove",function(){event.preventDefault()});var V=null;a.addEventListener("touchstart",function(a){a.targetTouches.length>0&&(V=a.targetTouches[0])}),a.addEventListener("touchend",function(a){if(a.changedTouches.length>0&&null!=V){var b=a.changedTouches[0].pageX-V.pageX,c=a.changedTouches[0].pageY-V.pageY;if(Math.abs(b)<20&&Math.abs(c)<20)return void(V=null);Math.abs(b)>3*Math.abs(c)?b>0?e.video.paused&&e.btnPlay.click():e.video.paused||e.btnPlay.click():Math.abs(c)>3*Math.abs(b)&&(e.video.volume=0>c?Math.min(1,e.video.volume+.1):Math.max(0,e.video.volume-.1)),V=null}}),a.addEventListener("mouseup",function(){if(document.activeElement!=e.txtText&&document.activeElement!=e.timeJump){var a=window.scrollY;e.videoDiv.focus(),window.scrollTo(window.scrollX,a)}})}if(null!==e.txtText&&e.txtText.addEventListener("keyup",function(a){if(null!=this.value)if(this.style.color=/^!/.test(this.value)?"#5DE534":"",null!=a&&13===a.keyCode){if(""==this.value)return;if(/^!/.test(this.value)){var b=this.value.substring(1).split(":"),c=b.shift();switch(c){case"help":{e.createPopup("提示信息：",2e3)}break;case"speed":case"rate":case"spd":if(b.length<1)e.createPopup("速度调节：输入百分比【 1% - 300% 】",2e3);else{var d=parseInt(b[0]);if(0/0!=d){var f=Math.min(Math.max(d,1),300);e.video.playbackRate=f/100}null!==e.cmManager&&e.cmManager.clear()}break;case"off":e.cmManager.display=!1,e.cmManager.clear(),e.cmManager.stopTimer();break;case"on":e.cmManager.display=!0,e.cmManager.startTimer();break;case"cls":case"clear":null!==e.cmManager&&e.cmManager.clear();break;case"pp":case"pause":e.video.pause();break;case"p":case"play":e.video.play();break;case"vol":case"volume":if(0==b.length){e.createPopup("目前音量："+Math.round(100*e.video.volume)+"%",2e3)}else{var g=parseInt(b[0]);null!==g&&0/0!==g&&(e.video.volume=Math.max(Math.min(g,100),0)/100),e.createPopup("目前音量："+Math.round(100*e.video.volume)+"%",2e3)}}this.value=""}}else if(null!=a&&38===a.keyCode)if(a.shiftKey){if(null!==e.cmManager){var h=Math.min(Math.round(100*e.cmManager.options.opacity)+5,100);e.cmManager.options.opacity=h/100,e.removePopup();{e.createPopup("弹幕透明度："+Math.round(h)+"%",800)}}}else{e.video.volume=Math.round(Math.min(100*e.video.volume+5,100))/100,e.removePopup();{e.createPopup("目前音量："+Math.round(100*e.video.volume)+"%",800)}}else if(null!=a&&40===a.keyCode)if(a.shiftKey){if(null!==e.cmManager){var h=Math.max(Math.round(100*e.cmManager.options.opacity)-5,0);e.cmManager.options.opacity=h/100,e.removePopup();{e.createPopup("弹幕透明度："+Math.round(h)+"%",800)}}}else{e.video.volume=Math.round(Math.max(100*e.video.volume-5,0))/100,e.removePopup();{e.createPopup("目前音量："+Math.round(100*e.video.volume)+"%",800)}}}),"undefined"!=typeof CommentManager&&e.state.autosize){var W=function(){if(0!==o.videoHeight&&0!==o.videoWidth){var b=o.videoHeight/o.videoWidth,c=a.offsetWidth,d=a.offsetHeight,f=d/c;b>f?(a.style.width=d/b+"px",a.style.height=d+"px"):(a.style.width=c+"px",a.style.height=c*b+"px"),e.cmManager.setBounds()}};o.addEventListener("loadedmetadata",W),W()}return e}}}}}}}}}}}}}}}}}}}}}();